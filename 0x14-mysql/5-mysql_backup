#!/bin/bash

# Check if the password argument is provided
if [ $# -ne 1 ]; then
    echo "Usage: $0 <mysql_password>"
    exit 1
fi

# Set the MySQL password
MYSQL_PASSWORD="$1"

# Define the backup directory and file names
BACKUP_DIR="/path/to/backup/directory"
BACKUP_FILE="backup.sql"
ARCHIVE_NAME="$(date +'%d-%m-%Y').tar.gz"

# Dump all MySQL databases to a file
mysqldump -u root -p"${MYSQL_PASSWORD}" --all-databases > "${BACKUP_DIR}/${BACKUP_FILE}"

# Check if mysqldump was successful
if [ $? -ne 0 ]; then
    echo "Error: MySQL dump failed. Exiting..."
    exit 1
fi

# Create a compressed archive of the backup file
tar -czf "${BACKUP_DIR}/${ARCHIVE_NAME}" -C "${BACKUP_DIR}" "${BACKUP_FILE}"

# Check if the archive creation was successful
if [ $? -ne 0 ]; then
    echo "Error: Compression failed. Exiting..."
    exit 1
fi

echo "Backup completed successfully: ${BACKUP_DIR}/${ARCHIVE_NAME}"
